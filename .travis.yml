sudo: required
services:
  - docker
jobs:
    include:
        - stage: Test
        - before_install:
          - openssl aes-256-cbc -K $encrypted_7b9dbc922c26_key -iv $encrypted_7b9dbc922c26_iv -in secrets.tar.enc -out secrets.tar -d
          - tar -xf secrets.tar -C config/
        - install:
          - docker-compose build
          - docker-compose up -d app
        - script:
          - docker-compose exec app rails db:migrate
          - docker-compose exec app bundle exec rspec
          - docker-compose exec app rails_best_practices .
